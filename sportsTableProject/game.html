<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.css">
</head>
<body>
    <div>

        <div class="notification is-danger">

            <nav class="level">
                <!-- Left side -->
                <div class="level-left">
                    <div class="level-item">
                        <span class="icon">
                            <i class="fas fa-heart fa-xl"></i>
                        </span>
                    </div>
                    <div class="level-item">
                        <h3 class="level-item is-title">
                            <a href="home.html"><strong>TEAM LIQUID CURLING ASSOCIATION</strong></a>
                        </h3>
                    </div>
                    <div class="level-item">
                        <span>
                            <i class="fas fa-glass-water fa-xl"></i>
                        </span>
                    </div>

                    <div class="level-item">
                        <p>home</p>
                    </div>
                </div>

                <!-- Right side -->
                <div class="level-right">
                    <p class="level-item"><a href="teams.html">Our Teams</a></p>
                    <p class="level-item"><a href="standings.html">Current Standings</a></p>
                    <p class="level-item"><a>Live Scores</a></p>
                    <p class="level-item"><a class="button is-warning" href="login.html">Login</a></p>
                </div>
            </nav>
        </div>
    </div>
    <br>
    <div class="container">
        <div class="content is-medium">
            <h1 id="title"></h1>
        </div>
    </div>
    <div class="container">
        <!-- <table id="scores" class="table is-fullwidth">
            <thead>
                <tr>
                    <th class="N">Team Name</th>
                    <th class="1">1</th>
                    <th class="2">2</th>
                    <th class="3">3</th>
                    <th class="4">4</th>
                    <th class="5">5</th>
                    <th class="6">6</th>
                    <th class="7">7</th>
                    <th class="8">8</th>
                    <th class="9">9</th>
                    <th class="Tot">Total</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table> -->
    </div>
</body>
<script>
    const data = JSON.parse(localStorage.getItem('teams'));

    const tableContainer = document.querySelector("body > div:nth-child(4)");


    addTitle();

    //I do this as a work around so I know the index of the team that we are displaying
    const index = getIndex();

    //lets the program know how many tables to create since there are two arrays per game
    const numTables = data[index].games.length / 2;

    //I initially used i as my index but it didnt work for whatever reason so k is always a good kandidate haha Im so funny
    for (k = 0; k < numTables; k++) {
        createTable(2 * k);
    }

    function createTable(tableIndex) {
        makeTableHead(tableIndex)
        
        for (i = 0; i < 2; i ++) {
            let score = data[index].games[tableIndex + i]
            const row = document.createElement('tr');
            let td = document.createElement('td');
            td.textContent = score.Name;
            row.appendChild(td);

            let totalScore = 0;
            for (j = 1; j < Object.keys(score).length; j++) {
                td = document.createElement('td');
                td.textContent = score[j];
                row.appendChild(td);

                //need the parseInt for some reason. Not too sure why but itll print like 20002010 as the total score without it so it stays
                totalScore = totalScore + parseInt(score[j])
            }
            td = document.createElement('td');
            td.textContent = totalScore;
            td.setAttribute('value', totalScore)
            td.classList.add("totalScore")
            row.appendChild(td);

            let tableBody = document.querySelector(`#scores${tableIndex}`);
            tableBody.appendChild(row);
        }
        
        //i want to make it highlight it green if u win and red if u lose
        if (parseInt(document.querySelector(`#scores${tableIndex} > tr:nth-child(2) > td:nth-child(11)`).textContent) > parseInt(document.querySelector(`#scores${tableIndex} > tr:nth-child(3) > td:nth-child(11)`).textContent)) {
            let winner = document.querySelector(`#scores${tableIndex} > tr:nth-child(2) > td:nth-child(1)`)
            let loser = document.querySelector(`#scores${tableIndex} > tr:nth-child(3) > td:nth-child(1)`)
            

            //makes it green
            winner.classList.add('content')
            winner.classList.add("is-primary")

            //makes it red
            loser.classList.add('content')
            loser.classList.add("is-danger")
        } else {
            let loser = document.querySelector(`#scores${tableIndex} > tr:nth-child(2) > td:nth-child(1)`)
            let winner = document.querySelector(`#scores${tableIndex} > tr:nth-child(3) > td:nth-child(1)`)

            //makes it green
            winner.classList.add('content')
            winner.classList.add("is-primary")

            //makes it red
            loser.classList.add('content')
            loser.classList.add("is-danger")
        }
    }

    //I know I dont need this but this is to make this thing easier to debug.
    function makeTableHead(tableIndex) {
        let table = document.createElement('table')
        let thead = document.createElement('thead')
        table.setAttribute('id', `scores${tableIndex}`)
        table.classList.add("table")
        table.classList.add("is-fullwidth")

        let headRow = document.createElement("tr");
        let headCellName = document.createElement('th');
        headCellName.classList.add('N');
        headRow.appendChild(headCellName)
        headCellName.textContent = 'Team Name';

        for (i = 1; i < 10; i++) {
            let th = document.createElement('th')
            th.classList.add(i)
            th.textContent = i
            headRow.appendChild(th)
        }

        let totalCell = document.createElement('th');
        totalCell.classList.add('tot');
        totalCell.textContent = 'Total';
        headRow.appendChild(totalCell)

        thead.appendChild(headRow);
        table.appendChild(thead)
        tableContainer.appendChild(table);
    }

    function addTitle() {
        let location = document.querySelector("#title")

        //sets the title to match whatever is in the search URL
        location.textContent = `Here are all the recent games played by team ${window.location.href.slice(window.location.href.indexOf("?team=") +6)}`;
    }

    function getIndex() {
        //simply iterates through all the teams and determines if they are the correct one or not
        for (i = 0; i < Object.keys(data).length; i++) {
            if (data[i].Team === window.location.href.slice(window.location.href.indexOf("?team=") +6)) {
                return i;
            }
        }
    }

</script>

</html>